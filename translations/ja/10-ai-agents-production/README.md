# 本番環境でのAIエージェント

## はじめに

このレッスンでは以下の内容を学びます：

- AIエージェントを本番環境に効果的に展開するための計画方法。
- AIエージェントを本番環境に展開する際によくあるミスや問題点。
- コストを管理しながらAIエージェントのパフォーマンスを維持する方法。

## 学習目標

このレッスンを終えた後、以下について理解し、実践できるようになります：

- 本番環境でのAIエージェントシステムのパフォーマンス、コスト、効果を向上させるためのテクニック。
- AIエージェントをどのように評価し、何を評価すべきか。
- AIエージェントを本番環境に展開する際のコスト管理方法。

信頼できるAIエージェントを展開することは非常に重要です。「信頼できるAIエージェントを構築する」レッスンもぜひ確認してください。

## AIエージェントの評価

AIエージェントを展開する前、展開中、そして展開後に、適切な評価システムを持つことは非常に重要です。これにより、システムが自分やユーザーの目標に合致していることを確認できます。

AIエージェントを評価する際には、エージェントの出力だけでなく、エージェントが動作している全体のシステムを評価する能力が必要です。これには以下が含まれますが、これに限定されません：

- 初期のモデルリクエスト。
- ユーザーの意図を特定するエージェントの能力。
- タスクを実行するために適切なツールを選択するエージェントの能力。
- エージェントのリクエストに対するツールの応答。
- ツールの応答を解釈するエージェントの能力。
- エージェントの応答に対するユーザーのフィードバック。

これにより、改善が必要な箇所をモジュール単位で特定しやすくなります。また、モデル、プロンプト、ツール、その他のコンポーネントへの変更の影響を効率的に監視することができます。

## AIエージェントに関する一般的な問題とその解決策

| **問題点**                                    | **潜在的な解決策**                                                                                                                                                                                                          |
| --------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| AIエージェントがタスクを一貫して実行しない    | - AIエージェントに与えるプロンプトを改善し、目標を明確にする。<br>- タスクをサブタスクに分割し、複数のエージェントで処理する方法を検討する。                                                                                 |
| AIエージェントが連続ループに陥る              | - 明確な終了条件を設定し、エージェントがプロセスを停止するタイミングを理解できるようにする。<br>- 推論や計画を必要とする複雑なタスクには、推論タスクに特化した大規模モデルを使用する。                                           |
| AIエージェントのツール呼び出しがうまく機能しない | - エージェントシステムの外部でツールの出力をテストし、検証する。<br>- 定義されたパラメータ、プロンプト、ツールの名前付けを改善する。                                                                                          |
| マルチエージェントシステムが一貫して動作しない | - 各エージェントに与えるプロンプトを改善し、具体的で明確なものにする。<br>- "ルーティング"またはコントローラーエージェントを使用して、どのエージェントが適切かを判断する階層型システムを構築する。                                |

## コスト管理

AIエージェントを本番環境に展開する際のコスト管理のための戦略を以下に示します：

- **レスポンスのキャッシュ** - よくあるリクエストやタスクを特定し、それらのレスポンスをエージェントシステムを通さずに提供することで、類似したリクエストのボリュームを削減します。基本的なAIモデルを使ってリクエストがキャッシュされたものとどれだけ類似しているかを判断するフローを実装することも可能です。

- **小規模モデルの使用** - Small Language Models (SLMs) は、特定のエージェントユースケースで良いパフォーマンスを発揮し、コストを大幅に削減できます。前述のように、評価システムを構築して大規模モデルと比較し、SLMがユースケースにどれだけ適しているかを理解することが最善の方法です。

- **ルーターモデルの使用** - 似たような戦略として、多様なモデルやサイズを使用する方法があります。LLM/SLMやサーバーレス関数を使用して、リクエストの複雑さに基づいて最適なモデルにルーティングすることで、コストを削減しつつ、適切なタスクでのパフォーマンスを確保できます。

## おめでとうございます  

これで「AIエージェント入門」の最後のレッスンは終了です。

私たちは、この急成長する業界のフィードバックや変化に基づいて、引き続きレッスンを追加する予定ですので、近い将来ぜひ再訪してください。

AIエージェントについてさらに学び、構築を進めたい場合は、[Azure AI Community Discord](https://discord.gg/kzRShWzttr)に参加してください。

ここでは、ワークショップ、コミュニティラウンドテーブル、そして「何でも聞いてください」セッションを開催しています。

また、本番環境でAIエージェントを構築するのに役立つ追加資料の学習コレクションも用意していますので、ぜひご活用ください。

**免責事項**:  
この文書は、AI翻訳サービスを使用して機械的に翻訳されています。正確さを追求しておりますが、自動翻訳には誤りや不正確さが含まれる可能性があります。原文（元の言語で記載された文書）を公式かつ信頼できる情報源としてご参照ください。重要な情報については、専門の人間による翻訳をお勧めします。本翻訳の利用に起因する誤解や誤認について、当社は一切の責任を負いません。