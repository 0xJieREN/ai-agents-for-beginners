```markdown
# エージェンティックRAG

このレッスンでは、エージェンティックリトリーバル強化生成（Agentic RAG）について包括的に解説します。これは、大規模言語モデル（LLM）が外部ソースから情報を取得しながら、自律的に次のステップを計画する新しいAIパラダイムです。静的な「リトリーブ＆リード」パターンとは異なり、エージェンティックRAGでは、ツールや関数呼び出し、構造化出力を挟みながら、LLMへの反復的な呼び出しが行われます。このシステムは結果を評価し、クエリを洗練し、必要に応じて追加のツールを呼び出し、満足のいく解決策が得られるまでこのサイクルを続けます。

## はじめに

このレッスンでは以下を学びます。

- **エージェンティックRAGの理解:** 大規模言語モデル（LLM）が外部データソースから情報を取得しながら、自律的に次のステップを計画する新しいAIパラダイムについて学びます。
- **反復的なMaker-Checkerスタイル:** LLMへの反復的な呼び出し、ツールや関数呼び出し、構造化出力を組み合わせたループを理解し、正確性の向上や誤ったクエリの処理方法を学びます。
- **実用的な応用の探求:** 正確性が重要な環境、複雑なデータベース操作、長時間にわたるワークフローなど、エージェンティックRAGが活躍するシナリオを特定します。

## 学習目標

このレッスンを終えると、以下を理解できるようになります。

- **エージェンティックRAGの理解:** 大規模言語モデル（LLM）が外部データソースから情報を取得しながら、自律的に次のステップを計画する新しいAIパラダイムについて学びます。
- **反復的なMaker-Checkerスタイル:** LLMへの反復的な呼び出し、ツールや関数呼び出し、構造化出力を組み合わせたループを理解し、正確性の向上や誤ったクエリの処理方法を学びます。
- **推論プロセスの主体性:** システムが推論プロセスを主体的に管理し、事前定義されたパスに依存せずに問題へのアプローチ方法を決定する能力を理解します。
- **ワークフロー:** エージェンティックモデルが市場動向レポートを取得し、競合データを特定し、内部販売指標を関連付け、発見を統合し、戦略を評価するプロセスを独立して決定する方法を理解します。
- **反復ループ、ツール統合、メモリ:** システムが反復的な対話パターンに依存し、ステップ間で状態とメモリを維持することで、無駄なループを避け、情報に基づいた意思決定を行う方法を学びます。
- **失敗モードの処理と自己修正:** クエリの再実行、診断ツールの利用、人間の監督に依存する方法を含む、システムの強力な自己修正メカニズムを探ります。
- **エージェンシーの限界:** ドメイン固有の自律性、インフラ依存性、ガードレールの尊重に焦点を当てたエージェンティックRAGの限界を理解します。
- **実用的なユースケースと価値:** 正確性が重要な環境、複雑なデータベース操作、長時間にわたるワークフローなど、エージェンティックRAGが活躍するシナリオを特定します。
- **ガバナンス、透明性、信頼性:** 説明可能な推論、バイアス制御、人間の監督を含むガバナンスと透明性の重要性を学びます。

## エージェンティックRAGとは？

エージェンティックリトリーバル強化生成（Agentic RAG）は、大規模言語モデル（LLM）が外部ソースから情報を取得しながら、自律的に次のステップを計画する新しいAIパラダイムです。静的な「リトリーブ＆リード」パターンとは異なり、エージェンティックRAGでは、ツールや関数呼び出し、構造化出力を挟みながら、LLMへの反復的な呼び出しが行われます。このシステムは結果を評価し、クエリを洗練し、必要に応じて追加のツールを呼び出し、満足のいく解決策が得られるまでこのサイクルを続けます。この反復的な「Maker-Checker」スタイルにより、正確性が向上し、誤ったクエリが処理され、高品質な結果が保証されます。

このシステムは推論プロセスを主体的に管理し、失敗したクエリを書き直し、異なる取得方法を選択し、最終的な回答を出す前に、Azure AI Searchのベクター検索、SQLデータベース、カスタムAPIなどの複数のツールを統合します。エージェンティックシステムの際立った特徴は、推論プロセスを主体的に管理する能力にあります。従来のRAG実装では事前定義されたパスに依存しますが、エージェンティックシステムでは見つけた情報の品質に基づいてステップの順序を自律的に決定します。

## エージェンティックリトリーバル強化生成（Agentic RAG）の定義

エージェンティックリトリーバル強化生成（Agentic RAG）は、大規模言語モデル（LLM）が外部データソースから情報を取得するだけでなく、自律的に次のステップを計画するAI開発の新しいパラダイムです。静的な「リトリーブ＆リード」パターンや慎重にスクリプト化されたプロンプトシーケンスとは異なり、エージェンティックRAGでは、ツールや関数呼び出し、構造化出力を挟みながら、LLMへの反復的な呼び出しが行われます。システムは得られた結果を評価し、クエリを洗練し、必要に応じて追加のツールを呼び出し、満足のいく解決策が得られるまでこのサイクルを続けます。

この反復的な「Maker-Checker」スタイルの運用は、正確性を向上させ、構造化データベース（例：NL2SQL）への誤ったクエリを処理し、バランスの取れた高品質な結果を保証するよう設計されています。慎重に設計されたプロンプトチェーンにのみ依存するのではなく、システムは推論プロセスを主体的に管理します。失敗したクエリを書き直し、異なる取得方法を選択し、最終的な回答を出す前に、Azure AI Searchのベクター検索、SQLデータベース、カスタムAPIなどの複数のツールを統合することができます。これにより、過度に複雑なオーケストレーションフレームワークが不要になります。比較的シンプルな「LLM呼び出し → ツール使用 → LLM呼び出し → …」のループで、洗練された根拠のある出力を得ることができます。

![エージェンティックRAGのコアループ](../../../translated_images/agentic-rag-core-loop.2224925a913fb3439f518bda61a40096ddf6aa432a11c9b5bba8d0d625e47b79.ja.png)

## 推論プロセスの主体性

システムを「エージェンティック」とする際立った特徴は、推論プロセスを主体的に管理する能力です。従来のRAG実装では、モデルが何をいつ取得するかを事前に定義したパス（いわゆるチェインオブソート）に依存することが多いです。しかし、真にエージェンティックなシステムでは、問題へのアプローチ方法を内部で決定します。単なるスクリプトの実行ではなく、見つけた情報の品質に基づいてステップの順序を自律的に決定します。

例えば、製品発売戦略を作成するよう依頼された場合、研究や意思決定のワークフロー全体を記述したプロンプトにのみ依存するのではなく、エージェンティックモデルは以下のような手順を独立して決定します。

1. Bing Web Groundingを使用して現在の市場動向レポートを取得。
2. Azure AI Searchを活用して関連する競合データを特定。
3. Azure SQL Databaseを利用して内部の販売指標を歴史的に関連付け。
4. Azure OpenAI Serviceを通じて調査結果を統合し、一貫した戦略を作成。
5. 戦略のギャップや矛盾を評価し、必要に応じて再取得を促進。

これらのステップすべて—クエリの洗練、ソースの選択、「満足」するまでの反復—は、モデルが決定し、人間が事前にスクリプト化するものではありません。

## 反復ループ、ツール統合、メモリ

![ツール統合アーキテクチャ](../../../translated_images/tool-integration.7b05a923e3278bf1fd2972faa228fb2ac725f166ed084362b031a24bffd26287.ja.png)

エージェンティックシステムは以下のようなループ型の対話パターンに依存します。

- **初回呼び出し:** ユーザーの目標（ユーザープロンプト）がLLMに提示されます。
- **ツールの呼び出し:** モデルが不足している情報や曖昧な指示を特定した場合、ツールや取得方法を選択します。例えば、ベクターデータベースクエリ（例：Azure AI Searchのハイブリッド検索）や構造化SQL呼び出しを使用して、より多くのコンテキストを収集します。
- **評価と洗練:** 返されたデータを確認した後、モデルは情報が十分かどうかを判断します。不十分な場合は、クエリを洗練し、別のツールを試すか、アプローチを調整します。
- **満足するまで繰り返し:** モデルが十分な明確さと証拠を得たと判断するまで、このサイクルを続けます。
- **メモリと状態:** システムはステップ間で状態とメモリを維持するため、以前の試行とその結果を思い出し、無駄なループを避け、進行中により情報に基づいた意思決定を行います。

これにより、時間の経過とともに理解が進化し、人間が絶えず介入したりプロンプトを再構築したりする必要なく、複雑な多段階タスクをナビゲートできるようになります。

## 失敗モードの処理と自己修正

エージェンティックRAGの自律性には、強力な自己修正メカニズムも含まれています。システムが行き詰まった場合（例：関連性のないドキュメントを取得したり、誤ったクエリに遭遇したりした場合）、以下のような対策を講じます。

- **反復と再クエリ:** 価値の低い回答を返す代わりに、新しい検索戦略を試みたり、データベースクエリを書き直したり、代替データセットを検討します。
- **診断ツールの利用:** システムは、推論ステップをデバッグしたり、取得したデータの正確性を確認するための追加機能を呼び出すことがあります。Azure AI Tracingのようなツールは、強力な可観測性とモニタリングを可能にします。
- **人間の監督に依存:** 高リスクまたは繰り返し失敗するシナリオでは、モデルが不確実性をフラグとして示し、人間のガイダンスを求める場合があります。人間が是正フィードバックを提供すると、モデルはその教訓を以後に活用できます。

この反復的かつ動的なアプローチにより、モデルはセッション中に失敗から学習し続けることができ、一度限りのシステムではなく、改善を続けるシステムとなります。

![自己修正メカニズム](../../../translated_images/self-correction.3d42c31baf4a476bb89313cec58efb196b0e97959c04d7439cc23d27ef1242ac.ja.png)

## エージェンシーの限界

タスク内での自律性があるとはいえ、エージェンティックRAGは人工汎用知能（AGI）と同等ではありません。その「エージェンティック」な能力は、人間の開発者によって提供されたツール、データソース、ポリシーに限定されています。独自のツールを発明したり、設定されたドメインの境界を越えたりすることはできません。その代わりに、手元のリソースを動的に活用することで優れた成果を発揮します。

より高度なAI形態との主な違いは以下の通りです。

1. **ドメイン固有の自律性:** エージェンティックRAGシステムは、既知のドメイン内でユーザー定義の目標を達成することに焦点を当て、クエリの書き換えやツール選択などの戦略を活用して結果を改善します。
2. **インフラ依存性:** システムの能力は、開発者によって統合されたツールやデータに依存しています。これらの境界を人間の介入なしに超えることはできません。
3. **ガードレールの尊重:** 倫理的ガイドライン、コンプライアンスルール、ビジネスポリシーは依然として非常に重要です。エージェントの自由度は常に安全対策と監視メカニズムによって制約されています（おそらく？）。

## 実用的なユースケースと価値

エージェンティックRAGは、反復的な精査と正確性が求められるシナリオで特に活躍します。

1. **正確性が最優先の環境:** コンプライアンスチェック、規制分析、法的調査では、エージェンティックモデルが事実を繰り返し検証し、複数のソースを参照し、クエリを書き直して、徹底的に精査された回答を提供します。

2. **複雑なデータベース操作:** クエリが失敗したり調整が必要になることが多い構造化データを扱う場合、システムはAzure SQLやMicrosoft Fabric OneLakeを使用してクエリを自律的に洗練し、最終的な取得がユーザーの意図に合致するようにします。

3. **長時間にわたるワークフロー:** 新しい情報が浮上するにつれてセッションが進化する可能性がある場合、エージェンティックRAGは新しいデータを継続的に取り入れ、問題空間について学習するにつれて戦略を変更します。

## ガバナンス、透明性、信頼性

これらのシステムが推論においてより自律的になるにつれて、ガバナンスと透明性が重要になります。

- **説明可能な推論:** モデルは、実行したクエリ、参照したソース、結論に至るまでの推論ステップの監査記録を提供できます。Azure AI Content SafetyやAzure AI Tracing / GenAIOpsのようなツールは、透明性を維持し、リスクを軽減するのに役立ちます。
- **バイアス制御とバランスの取れた取得:** 開発者は、バランスの取れた代表的なデータソースが考慮されるように取得戦略を調整し、Azure Machine Learningを使用して高度なデータサイエンス組織向けにカスタムモデルを使用して、バイアスや偏ったパターンを検出するために定期的に出力を監査できます。
- **人間の監督とコンプライアンス:** センシティブなタスクでは、人間によるレビューが依然として不可欠です。エージェンティックRAGは、高リスクの意思決定において人間の

**免責事項**:  
この文書は、機械ベースのAI翻訳サービスを使用して翻訳されています。正確性を追求しておりますが、自動翻訳には誤りや不正確な部分が含まれる場合があります。原文（元の言語で記載された文書）が正式な情報源とみなされるべきです。重要な情報については、専門の人間による翻訳をお勧めします。本翻訳の利用により生じる誤解や解釈の誤りについて、当方は一切の責任を負いません。